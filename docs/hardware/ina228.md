# INA228 Battery Current/Voltage Monitor

## Overview

This circuit implements a battery monitoring system using the Texas Instruments INA228 current/voltage monitor IC. It measures both battery voltage and current through a low-side shunt resistor configuration, suitable for 48V battery systems with currents up to 500A (or any value, just need to keep shunt voltage <±163.84 mV)

## System Architecture

### Measurement Configuration
- **Battery Voltage Monitoring**: Direct measurement of battery positive terminal via VBUS input
- **Current Measurement**: Low-side shunt configuration with differential voltage measurement
- **Communication**: I2C interface at 7-bit address 0x40
- **Supply Voltage**: 3.3V logic supply

## Connection Descriptions

### Power and Signal Connections

#### Battery Interface
- **VBUS_INA228**: Connected directly to battery positive terminal
  - Feeds INA228 pin 8 (VBUS) for voltage measurement
  - Connected through R79 (100Ω) to system load
  - Low-pass filtered by R79 and C8 (1µF, 100V)

#### Current Shunt Interface
- **IN+_INA228**: High side of low-side shunt resistor
  - Connected through R72 (100Ω) to INA228 pin 10 (IN+)
  
- **IN-_INA228**: Low side of shunt resistor (battery ground/negative)
  - Connected through R73 (100Ω) to INA228 pin 9 (IN-)

#### INA228 IC (U20) Pin Configuration
| Pin | Function | Connection |
|-----|----------|------------|
| 1   | GND      | System Ground |
| 2   | A0       | System Ground (I2C address = 0x40) |
| 3   | ALERT    | ALERT! signal output |
| 4   | SDA      | I2C_SDA |
| 5   | SCL      | I2C_SCL |
| 6   | VS       | 3.3V supply |
| 7   | GND      | System Ground |
| 8   | VBUS     | Battery positive measurement |
| 9   | IN-      | Shunt negative terminal |
| 10  | IN+      | Shunt positive terminal |

### Power Supply Decoupling
- **C8**: 1µF, 100V - VBUS supply decoupling
- **Power supply decoupling for 3.3V rail** (external to this circuit)

## Protection Circuitry

### ESD and Transient Protection

#### Differential Input Protection
- **D20, D21**: PESD5V0S1UL bidirectional ESD protection diodes
  - Connected between IN+ and IN- inputs
  - Protects against differential transients
  - 5V standoff voltage will have no affect on mV-level shunt signals

#### Overvoltage Protection
- **D15**: P6SMB68A transient voltage suppressor
  - Connected from VBUS to GND
  - **Standoff Voltage**: 58.1V (~suitable for 59V max battery voltage)
  - **Breakdown Voltage**: 64.6V minimum
  - **Clamping Voltage**: 92V maximum @ Ipp
  - Protects against battery overvoltage events

### Noise Filtering

#### Input Series Resistance
Both differential measurement inputs feature matched 100Ω series resistors:

- **IN+ Series Resistance**: R72 (100Ω, 0.1% tolerance for matching)
- **IN- Series Resistance**: R73 (100Ω, 0.1% tolerance for matching)

These resistors provide:
- **Input protection** against transients
- **Symmetric impedance** for optimal common-mode rejection
- **EMI filtering** when combined with differential capacitance

#### VBUS Filtering
- **VBUS Filter**: R79 (100Ω) + C8 (1µF)
- **Cutoff Frequency**: fc ≈ 1.59 kHz

#### Differential Noise Reduction
- **C25**: 100nF, 100V capacitor connected directly between IN+ and IN-
- Provides high-frequency noise filtering for differential measurement
- **Critical Design Note**: No capacitors are connected from IN+ or IN- to ground, which prevents common-mode to differential-mode noise conversion through asymmetric coupling

**Differential Filter Characteristics:**
```
fc = 1 / (2π × R × C)
fc = 1 / (2π × 100Ω × 100nF)
fc ≈ 15.9 kHz
```

All filters can be bypassed with jumpers for testing or different filtering requirements.

## Electrical Specifications

### Operating Voltage Ranges

#### INA228 Absolute Maximum Ratings
| Parameter | Minimum | Maximum | Unit |
|-----------|---------|---------|------|
| Supply Voltage (VS) | - | 6 | V |
| VBUS | -0.3 | 85 | V |
| Differential (VIN+) - (VIN-) | -40 | +40 | V |
| Common-mode (VIN+, VIN-) | -0.3 | 85 | V |
| SDA, SCL | -0.3 | 6 | V |
| ALERT | -0.3 | VS + 0.3 | V |

#### System Design Margins
- **Battery Voltage Range**: 48V nominal, up to 59V maximum
- **VBUS Margin**: 85V max rating vs 59V system max = **26V margin**
- **Common-mode Margin**: Both IN+ and IN- operate near ground potential in low-side shunt configuration

### Current Measurement Specifications

#### Expected Signal Levels
- **Maximum Current**: 500A (extreme case)
- **Typical Shunt Resistance**: ~75µΩ to 150µΩ (standard for 500A applications)
- **Maximum Shunt Voltage**: 500A × 150µΩ = **75mV**
- **INA228 Differential Range**: ±163.84mV (typical) - **adequate margin**

## Power Consumption Analysis

### INA228 Power Consumption

#### Normal Operation (3.3V Supply)
- **Supply Current (Typical)**: 1.1mA
- **Supply Current (Maximum)**: 1.65mA
- **Standby Current**: 2.8µA (shutdown mode)

#### Calculated Power Consumption
```
Normal Operation:
P_typ = 3.3V × 1.1mA = 3.63mW
P_max = 3.3V × 1.65mA = 5.45mW

Standby Mode:
P_standby = 3.3V × 2.8µA = 9.24µW
```

### System Power Consumption Estimates

#### Continuous Monitoring Mode
| Condition | Supply Current | Power (3.3V) |
|-----------|----------------|--------------|
| Typical Operation | 1.1mA | 3.63mW |
| Maximum Operation | 1.65mA | 5.45mW |

#### Low Power Modes
| Condition | Supply Current | Power (3.3V) |
|-----------|----------------|--------------|
| Shutdown Mode | 2.8µA | 9.24µW |

*Note: Power consumption figures do not include I2C pull-up resistor power or external circuitry*

## Performance Characteristics

### Measurement Accuracy
- **Current Measurement Resolution**: Depends on shunt value and ADC configuration
- **Voltage Measurement Resolution**: Programmable, typically 16-bit effective

### Filtering Performance
- **VBUS Filter Bandwidth**: ~1.59kHz (-3dB point)
- **Differential Filter Bandwidth**: ~15.9kHz (-3dB point)
- **Common-mode Rejection**: Enhanced by symmetric input impedance design

## I2C Interface Configuration

### Device Address
- **7-bit Address**: 0x40 (A0 pin tied to ground)
- **R/W Bit**: Bit 0 of I2C transaction
- **Full 8-bit Address**: 0x80 (write), 0x81 (read)

### Communication Features
- **ALERT Pin**: Configurable threshold alerts
- **Data Rate**: Standard I2C speeds supported (100kHz, 400kHz)

## Design Verification Checklist

### Critical Parameters Verified
- ✅ P6SMB68A standoff voltage (58.1V) > max battery voltage (59V)
- ✅ All capacitor voltage ratings (100V) > max system voltage (59V)
- ✅ INA228 VBUS rating (85V) > max battery voltage (59V)
- ✅ Differential signal range within INA228 limits
- ✅ ESD protection appropriate for expected signal levels
- ✅ Filter cutoff frequencies suitable for battery monitoring application
- ✅ Symmetric input impedance for optimal common-mode rejection
- ✅ No ground-referenced capacitors on differential inputs to prevent CM→DM conversion